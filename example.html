<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JQState Mini-Framework</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --jq-primary: #0d6efd; --jq-dark: #212529; }
        body { background-color: #f8f9fa; color: #333; font-family: 'Segoe UI', Roboto, sans-serif; }
        .card { border: none; border-radius: 8px; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); margin-bottom: 24px; }
        .card h3 { font-size: 1.25rem; font-weight: 600; color: var(--jq-dark); border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .jq-blocked { opacity: 0.5; pointer-events: none; cursor: not-allowed; }
        pre { background: #1e1e1e; color: #9cdcfe; padding: 15px; border-radius: 6px; font-size: 13px; border-left: 4px solid var(--jq-primary); }
        .alert-info { border: none; border-left: 4px solid #0dcaf0; background-color: #e9f7fe; color: #31708f; }
        .form-label { font-weight: 500; font-size: 0.9rem; }
    </style>
</head>
<body class="p-5">

    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div id="todoApp" class="card p-4" data-initial='{"user": "Sistem Admin", "tasks": 0}'>
                    <h3 class="mb-3">Task Management</h3>
                    <div class="mb-3">
                        <label class="form-label">Identificação do Operador:</label>
                        <input type="text" data-bind="user" class="form-control" placeholder="Nome do usuário">
                    </div>
                    
                    <div class="alert alert-info py-2">
                        Usuário: <strong data-bind="user"></strong> | 
                        Pendências: <span data-bind="tasks" class="fw-bold"></span>
                    </div>

                    <div data-switch>
                        <div data-case="this.tasks > 10">
                            <p class="text-danger fw-bold small">Status: Sobrecarga de sistema</p>
                        </div>
                        <div data-case="this.tasks > 0 && this.tasks <= 10">
                            <p class="text-success fw-bold small">Status: Operação normal</p>
                        </div>
                        <div data-case="this.tasks <= 0">
                            <p class="text-muted fw-bold small">Status: Sistema ocioso</p>
                        </div>
                    </div>

                    <div class="d-flex gap-2 mt-2">
                        <button class="btn btn-primary btn-sm" data-click="this.tasks++">Adicionar Registro</button>
                        <button class="btn btn-outline-danger btn-sm" data-click="this.tasks = 0">Limpar Dados</button>
                    </div>
                </div>

                <div id="counterApp" class="card p-4">
                    <h3 class="mb-3">Controle de Fluxo</h3>
                    <div class="display-5 text-center my-3 fw-bold text-primary" data-bind="count">0</div>
                    <div class="d-flex gap-2 justify-content-center">
                        <button class="btn btn-secondary px-4" data-click="this.count--" data-on="this.count > 0"> - </button>
                        <button class="btn btn-primary px-4" data-click="this.count++" data-on="this.count < 10"> + </button>
                    </div>
                    <div class="text-center mt-2 small text-muted">Limite operacional: 0 a 10</div>
                </div>
            </div>

            <div class="col-md-6">
                <div id="formApp" class="card p-4" data-initial='{"active": true, "level": "pro"}'>
                    <h3 class="mb-3">Parâmetros de Perfil</h3>

                    <div class="mb-3">
                        <label class="form-label">Descrição Profissional:</label>
                        <textarea data-bind="bio" class="form-control" rows="2" placeholder="Resumo das atividades..."></textarea>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label class="form-label">Categoria:</label>
                            <select data-bind="category" class="form-select">
                                <option value="frontend">Frontend Development</option>
                                <option value="backend">Backend Development</option>
                                <option value="fullstack">Fullstack Solutions</option>
                            </select>
                        </div>
                        <div class="col">
                            <label class="form-label">Prazo Final:</label>
                            <input type="date" data-bind="deadline" class="form-control">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label d-block">Nível de Acesso:</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="lvl" data-bind="level" value="begginer" id="r1">
                            <label class="form-check-label small" for="r1">Básico</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="lvl" data-bind="level" value="pro" id="r2">
                            <label class="form-check-label small" for="r2">Avançado</label>
                        </div>
                    </div>

                    <div class="form-check form-switch mb-3">
                        <input type="checkbox" data-bind="active" class="form-check-input" id="checkActive">
                        <label class="form-check-label small fw-bold" for="checkActive">Conta Ativa</label>
                    </div>

                    <div class="mt-4">
                        <h6 class="small text-muted text-uppercase fw-bold">State Debugger (JSON)</h6>
                        <pre data-preview="JSON.stringify(this, null, 2)"></pre>
                    </div>
                </div>
            </div>

            <div class="col-md-12">
                <div id="busApp" class="card p-4 bg-dark text-white border-0">
                    <h3 class="text-white border-secondary mb-3">JQBus System Monitor</h3>
                    <div class="d-flex align-items-center gap-3">
                        <div class="spinner-grow spinner-grow-sm text-primary" role="status"></div>
                        <span data-bind="message" class="font-monospace">Aguardando telemetria...</span>
                    </div>
                    <div data-if="this.lastEvent" class="mt-3 border-top border-secondary pt-2">
                        <small class="text-secondary">Última atualização: <span data-bind="lastEvent" class="text-warning"></span></small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { JQState } from './JQState.js';
        import { JQBus } from './JQBus.js';

        const todo = new JQState('#todoApp');
        const counter = new JQState('#counterApp', { count: 0 });
        const busApp = new JQState('#busApp', { 
            message: 'Núcleo de eventos inicializado.',
            lastEvent: '' 
        });

        JQBus.on('LIMIT_REACHED', (data) => {
            busApp.state.message = `Alerta de Sistema: Usuário ${data.user} atingiu o limite de ${data.val} unidades no contador.`;
            busApp.state.lastEvent = new Date().toLocaleTimeString();
        });

        counter.on("count", (state, newValue) => {
            if (newValue === 10) {
                JQBus.emit('LIMIT_REACHED', { 
                    user: todo.state.user || "Anônimo", 
                    val: newValue
                });
            }
        });

        const form = new JQState('#formApp', {
            bio: 'Especialista em arquitetura de software.',
            category: 'fullstack'
        });

        console.log("JQState Professional Environment Initialized.");
    </script>
</body>
</html>